\documentclass[a4paper]{IEEEtran}

\usepackage{xcolor}
\usepackage{hyperref}
\usepackage[utf8]{inputenc}
\usepackage[pdftex]{graphicx} 
\usepackage{multirow, pgfplotstable,booktabs,colortbl,lmodern}

\newcommand\TODO[1]{\textcolor{red}{TODO:#1}}
\newcommand\todo[1]{\TODO{#1}}
\newcommand\cn{\textcolor{red}{[citation needed]}}

\title{The overpowered prefetcher of goodness and excellence!}

\author{
    Sigve Sebastian Farstad,
    Rune Holmgren,
    Torbjørn Langland,
    Per Thomas Lundal
}

\begin{document}

\maketitle

\begin{abstract}
    Le abstract.\cn
\end{abstract}

\section{Introduction}

\todo{ Write briefly about the project, the course it belongs to and the goal}
This is the introduction section.
Here we write something appealing for you to continue on.
If you finish this, you will be baked a cake.

As part of the course TDT4260 Computer Architecture, students in groups of 3 or 4 were to implement and test a prefetcher.
This report describes the implementation with test results done by group 11.
The report will describe the framework for the project, different prefetchers that have been implemented, how they work and the test results.

\section{Related Work}

\todo{ Not sure, mention related work?}
Here we mention related work. Do you want cake for your relatives?

\subsection{Delta Correlation Prefetching}
\todo{write something!}

\subsection{Global History Buffer}
History based prefetchers need to store access patterns efficient data structure that enables quick access.
One such data structure is the Global History Buffer (GHB) \cite{ghb}.
GHB is an $n$-entry First-In, First-Out (FIFO) queue implemented as a circular buffer.
It stores the $n$ most recent L1 cache misses in entries that contain the miss address and a link pointer.
The link pointer is used to chain entries together into time-ordered linked lists that holds the significant access patterns.
An Index Table (IT) is used to keep track of these lists.
It maps some key to the most recent element of a linked list.
The IT is based on a FIFO queue like GHB, but significantly smaller as each entry has to be evaluated for each cache miss to look up a matching key.
The key can be based on any cache miss information, and depending on it a wide variety of history based prefetch methods can be implemented.
In a comparison of different prefetch mechanisms by Péres et al.\cite{microlib}, one using GHB gave the best performance.
\todo{figure}

\section{Prefetcher Description}
A total of 5 different prefetchers have been implemented and tested. 

\subsection{CZone Delta Correlation}
In this section, CZone Delta Correlation will be explained.

\begin{figure}[h!]
  \centering
      \includegraphics[width=0.5\textwidth]{Figures/CDC}
  \caption{CZone Delta Correlation Prefetch}
  \label{fig:CDC}
\end{figure}

Figure \ref{fig:CDC} shows how CZone Delta Correlation works. The memory is divided into different concentration zones (CZones). The different CZones that are accessed are put into an index table, with a tag of each CZone used for indexing, and a pointer to a Global History Buffer (GHB) that contains addresses for missed loads. In other types of prefetchers, these missed addresses are indexed in the GHB by the value of the PC, but in this case addresses from the same CZone are linked together using linked list, with the latest missed address entry as head. In the example figure, address C09 from CZone C is the head, and is linked to C08,  which again is linked to C06, etc. The pointers from the Index Table points to these heads. The delta between the different addresses are calculated, and the first two from the linked list is added to the Correlation Key Register (2 and 1 in the example). The list is traversed, and the Correlation Comparison Register is continiously uptdated with the two latest deltas. Whenever there is a hit between the Comparison Registers and the Key Registers, and the distance between the current deltas and first two deltas in the linked list are not too great (max 4)\todo{ Per, hva brukte du?} a prefetch occurs. All deltas in between are added to a Delta Buffer, and they are used to calculate addresses for prefetch, using the two first addresses in the linked list and the contents in the delta buffer. \todo{ Correct? }. 

\todo{ Figure \ref{fig:CDC} is picked from the internet. Add reference? }

\subsection{Adaptive CZone Delta Correlation}


\subsection{Program Counter Delta Corelation}
\todo{write something}

\subsection{Adaptive Program Counter Delta Corelation}
\todo{write something}

\subsection{Delta Correlation Prediction Tables}

\todo{Describe how the final prefetcher works. I suggest adding a figure. Maybe briefly mention other attempts while if we have space?}

It is common for programs to access datastructures in neatly organized patterns.
In figure \ref{fig:DCExample} values are read with delta values 1 and 9, and this pattern repeats.
Such pattern may be exploited by prefetchers to predict what data will be read next.
A delta correlation prediction table will identify these patterns by comparing the delta values observed on misses with the history for resent misses.
When such patterns are found, the prefetcher will fetch the predicted cachelines into a circular buffer.


\begin{figure}[h!]
  \centering
      \includegraphics[width=0.5\textwidth]{Figures/DCExample}
  \caption{Delta Correlation Example}
  \label{fig:DCExample}
\end{figure}

As can be seen, the a row in the table contains fields for the PC, last address, last prefetch, deltas 1 to n, and delta pointer.
PC stores the address to the load instruction, and works as index in the table.
The Last Address stores the missed address when there is a miss in the cache.
The delta fields stores the address difference, or the deltas, for each time this instruction is called.
Last prefetch contains the address of the last issued prefetch.
The Delta Pointer points to the head (first Delta field) in the row, since the delta fields are used as circular buffer.

\begin{figure}[h!]
  \centering
      \includegraphics[width=0.5\textwidth]{Figures/DCTable}
  \caption{Delta Correlation Prediction Table}
  \label{fig:DCTable}
\end{figure}

\section{Methodology}

\todo{Mention the framework. Explain PFJudge. Maybe or maybe not mention C++?}
Here we describe how we did it.

WARNING: Recipee too long. Insert cake recipe here!

\section{Results}

\todo{ Describe results from both local and PFJudge.}

\input{graphs.tex}

EXPLOSION!

\section{Discussion}

\todo{ Not exactly sure, just say it works better? Compare with other prefetcher IF we chose to describe them. }

You killed GLaDOS.
You monster.

\section{Conclusion}

\todo{ Mention what could have been done better or different? Future ideas? }

The cake is a lie!

\section{Acknowledgements (optional)}

GLaDOS

yoyo \cite{assignment-text}

\bibliography{bibliography}
\bibliographystyle{plain}
\nocite{*}

\end{document}
